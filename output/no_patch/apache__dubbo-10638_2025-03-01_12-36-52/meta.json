{
    "task_id": "apache__dubbo-10638",
    "setup_info": {
        "repo_path": "/Users/rabeyakhatunmuna/Documents/research/SOEN691-Project-AutoCodeRover/SWE-bench/testbed/apache__dubbo/setup_apache__dubbo__0.1",
        "env_name": "setup_apache__dubbo__0.1",
        "pre_install": [],
        "install": "mvn clean install -Dmaven.test.skip=true",
        "test_cmd": "mvn clean test dubbo-common/src/test/java/org/apache/dubbo/common/utils/PojoUtilsTest.java"
    },
    "task_info": {
        "repo": "apache/dubbo",
        "pull_number": 10638,
        "instance_id": "apache__dubbo-10638",
        "issue_numbers": [
            "10631"
        ],
        "base_commit": "43d48bd6caf95f61f4e879a5be8b5560a55daee9",
        "patch": "diff --git a/dubbo-common/src/main/java/org/apache/dubbo/common/utils/CompatibleTypeUtils.java b/dubbo-common/src/main/java/org/apache/dubbo/common/utils/CompatibleTypeUtils.java\nindex dc113e1ae8b..a57f53f82ae 100644\n--- a/dubbo-common/src/main/java/org/apache/dubbo/common/utils/CompatibleTypeUtils.java\n+++ b/dubbo-common/src/main/java/org/apache/dubbo/common/utils/CompatibleTypeUtils.java\n@@ -23,6 +23,7 @@\n import java.text.SimpleDateFormat;\n import java.time.LocalDate;\n import java.time.LocalDateTime;\n+import java.time.LocalTime;\n import java.util.ArrayList;\n import java.util.Collection;\n import java.util.Date;\n@@ -34,6 +35,11 @@ public class CompatibleTypeUtils {\n \n     private static final String DATE_FORMAT = \"yyyy-MM-dd HH:mm:ss\";\n \n+    /**\n+     * the text to parse such as \"2007-12-03T10:15:30\"\n+     */\n+    private static final int ISO_LOCAL_DATE_TIME_MIN_LEN = 19;\n+\n     private CompatibleTypeUtils() {\n     }\n \n@@ -128,7 +134,12 @@ public static Object compatibleTypeConvert(Object value, Class<?> type) {\n                 if (StringUtils.isEmpty(string)) {\n                     return null;\n                 }\n-                return LocalDateTime.parse(string).toLocalTime();\n+                \n+                if (string.length() >= ISO_LOCAL_DATE_TIME_MIN_LEN) {\n+                    return LocalDateTime.parse(string).toLocalTime();\n+                } else {\n+                    return LocalTime.parse(string);\n+                }\n             }\n             if (type == Class.class) {\n                 try {\ndiff --git a/dubbo-common/src/main/java/org/apache/dubbo/common/utils/PojoUtils.java b/dubbo-common/src/main/java/org/apache/dubbo/common/utils/PojoUtils.java\nindex c6e2eaeb7cf..b8abfa65330 100644\n--- a/dubbo-common/src/main/java/org/apache/dubbo/common/utils/PojoUtils.java\n+++ b/dubbo-common/src/main/java/org/apache/dubbo/common/utils/PojoUtils.java\n@@ -33,6 +33,9 @@\n import java.lang.reflect.Type;\n import java.lang.reflect.TypeVariable;\n import java.lang.reflect.WildcardType;\n+import java.time.LocalDate;\n+import java.time.LocalDateTime;\n+import java.time.LocalTime;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.Collection;\n@@ -141,6 +144,10 @@ private static Object generalize(Object pojo, Map<Object, Object> history) {\n         if (ReflectUtils.isPrimitives(pojo.getClass())) {\n             return pojo;\n         }\n+        \n+        if (pojo instanceof LocalDate || pojo instanceof LocalDateTime || pojo instanceof LocalTime) {\n+            return pojo.toString();\n+        }\n \n         if (pojo instanceof Class) {\n             return ((Class) pojo).getName();\n",
        "test_patch": "diff --git a/dubbo-common/src/test/java/org/apache/dubbo/common/utils/PojoUtilsTest.java b/dubbo-common/src/test/java/org/apache/dubbo/common/utils/PojoUtilsTest.java\nindex e615dd97b12..6a0f1ef69e7 100644\n--- a/dubbo-common/src/test/java/org/apache/dubbo/common/utils/PojoUtilsTest.java\n+++ b/dubbo-common/src/test/java/org/apache/dubbo/common/utils/PojoUtilsTest.java\n@@ -32,6 +32,9 @@\n import java.lang.reflect.Method;\n import java.lang.reflect.Type;\n import java.text.SimpleDateFormat;\n+import java.time.LocalDate;\n+import java.time.LocalDateTime;\n+import java.time.LocalTime;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.Date;\n@@ -760,6 +763,22 @@ public void testRealizeCollectionWithNullElement() {\n         assertEquals(setResult, setStr);\n     }\n \n+    @Test\n+    public void testJava8Time() {\n+        \n+        Object localDateTimeGen = PojoUtils.generalize(LocalDateTime.now());\n+        Object localDateTime = PojoUtils.realize(localDateTimeGen, LocalDateTime.class);\n+        assertEquals(localDateTimeGen, localDateTime.toString());\n+\n+        Object localDateGen = PojoUtils.generalize(LocalDate.now());\n+        Object localDate = PojoUtils.realize(localDateGen, LocalDate.class);\n+        assertEquals(localDateGen, localDate.toString());\n+\n+        Object localTimeGen = PojoUtils.generalize(LocalTime.now());\n+        Object localTime = PojoUtils.realize(localTimeGen, LocalTime.class);\n+        assertEquals(localTimeGen, localTime.toString());\n+    }\n+\n     public enum Day {\n         SUNDAY, MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY\n     }\n",
        "problem_statement": "The generalized call does not support the serialization and deserialization of LocalTime, LocalDate & LocalDateTime\n<!-- If you need to report a security issue please visit https://github.com/apache/dubbo/security/policy -->\r\n\r\n- [x] I have searched the [issues](https://github.com/apache/dubbo/issues) of this repository and believe that this is not a duplicate.\r\n\r\n### Environment\r\n\r\n* Dubbo version: 2.7.x,3.x\r\n* Operating System version: mac os\r\n* Java version: 1.8\r\n\r\n### Steps to reproduce this issue\r\n\r\n```java\r\n\r\n@Bean\r\npublic GenericService testApi() {\r\n    ReferenceConfig<GenericService> config = new ReferenceConfig<>();\r\n    config.setInterface(\"com.xxx.TestApi\");\r\n    config.setGeneric(\"true\");\r\n    //...\r\n    return config.get()\r\n}\r\n\r\n\r\n@Autowired\r\nprivate TestApi testApi;\r\n\r\n@Test\r\nvoid testLocaDateTime() {\r\n    Person obj = testApi.testApiQueryMethod();\r\n}\r\n```\r\n![image](https://user-images.githubusercontent.com/5037807/190542582-6c39ebe5-b1bc-41d6-bf2c-ac2bb5155db0.png)\r\n\r\nUnit testing for reproducible problems\r\n```java\r\n    @Test\r\n    public void testJava8Time() {\r\n        \r\n        Object localDateTimeGen = PojoUtils.generalize(LocalDateTime.now());\r\n        Object localDateTime = PojoUtils.realize(localDateTimeGen, LocalDateTime.class);\r\n        assertEquals(localDateTimeGen, localDateTime.toString());\r\n\r\n        Object localDateGen = PojoUtils.generalize(LocalDate.now());\r\n        Object localDate = PojoUtils.realize(localDateGen, LocalDate.class);\r\n        assertEquals(localDateGen, localDate.toString());\r\n\r\n        Object localTimeGen = PojoUtils.generalize(LocalTime.now());\r\n        Object localTime = PojoUtils.realize(localTimeGen, LocalTime.class);\r\n        assertEquals(localTimeGen, localTime.toString());\r\n    }\r\n```\r\n\r\n\n",
        "hints_text": "",
        "created_at": 1663570519000,
        "FAIL_TO_PASS": [
            "dubbo-common:org.apache.dubbo.common.utils.PojoUtilsTest"
        ],
        "PASS_TO_PASS": [],
        "version": "0.1",
        "pr_link": "https://github.com/apache/dubbo/pull/10638"
    }
}