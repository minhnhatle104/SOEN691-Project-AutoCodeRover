{
    "task_id": "sympy__sympy-16503",
    "setup_info": {
        "repo_path": "/media/media0/yuntong/SWE-bench/testbed/sympy__sympy/setup_sympy__sympy__1.5",
        "env_name": "setup_sympy__sympy__1.5",
        "pre_install": [],
        "install": "python -m pip install -e .",
        "test_cmd": "bin/test -C --verbose sympy/printing/pretty/tests/test_pretty.py"
    },
    "task_info": {
        "instance_id": "sympy__sympy-16503",
        "base_commit": "a7e6f093c98a3c4783848a19fce646e32b6e0161",
        "hints_text": "```\r\n>>> pprint(Sum(x**2, (x, 1, oo)) + 3)\r\n \u221e         \r\n ___        \r\n \u2572          \r\n  \u2572    2    \r\n  \u2571   x  + 3\r\n \u2571          \r\n \u203e\u203e\u203e        \r\nx = 1\r\n```\r\nThis works well. So, I suppose that `x`, in the above case should be lower.\r\nCould you tell me, how I can correct it?\nThe issue might be with the way adjustments are calculated, and this definitely works for simpler expressions:\r\n```diff\r\ndiff --git a/sympy/printing/pretty/pretty.py b/sympy/printing/pretty/pretty.py\r\nindex 7a3de3352..07198bea4 100644\r\n--- a/sympy/printing/pretty/pretty.py\r\n+++ b/sympy/printing/pretty/pretty.py\r\n@@ -575,7 +575,7 @@ def adjust(s, wid=None, how='<^>'):\r\n                 for i in reversed(range(0, d)):\r\n                     lines.append('%s%s%s' % (' '*i, vsum[4], ' '*(w - i - 1)))\r\n                 lines.append(vsum[8]*(w))\r\n-                return d, h + 2*more, lines, more\r\n+                return d, h + 2*more, lines, more // 2\r\n \r\n         f = expr.function\r\n```\r\nas in\r\n```python\r\n>>> pprint(Sum(x ** n, (n, 1, oo)) + x)\r\n      \u221e     \r\n     ___    \r\n     \u2572      \r\n      \u2572    n\r\nx +   \u2571   x \r\n     \u2571      \r\n     \u203e\u203e\u203e    \r\n    n = 1   \r\n\r\n>>> pprint(Sum(n, (n, 1, oo)) + x)\r\n      \u221e    \r\n     ___   \r\n     \u2572     \r\n      \u2572    \r\nx +   \u2571   n\r\n     \u2571     \r\n     \u203e\u203e\u203e   \r\n    n = 1   \r\n```\r\n\r\nbut this leads to test failures for more complex expressions. However, many of the tests look like they expect the misaligned sum.\nThe ascii printer also has this issue:\r\n```\r\nIn [1]: pprint(x + Sum(x + Integral(x**2 + x + 1, (x, 0, n)), (n, 1, oo)), use_unicode=False)\r\n       oo                            \r\n    ______                           \r\n    \\     `                          \r\n     \\      /      n                \\\r\n      \\     |      /                |\r\n       \\    |     |                 |\r\nx +     \\   |     |  / 2        \\   |\r\n        /   |x +  |  \\x  + x + 1/ dx|\r\n       /    |     |                 |\r\n      /     |    /                  |\r\n     /      \\    0                  /\r\n    /_____,                          \r\n     n = 1                           \r\n\r\n```",
        "created_at": "2019-03-30T19:21:15Z",
        "test_patch": "diff --git a/sympy/printing/pretty/tests/test_pretty.py b/sympy/printing/pretty/tests/test_pretty.py\n--- a/sympy/printing/pretty/tests/test_pretty.py\n+++ b/sympy/printing/pretty/tests/test_pretty.py\n@@ -4423,14 +4423,14 @@ def test_pretty_sum():\n   n             \\n\\\n ______          \\n\\\n \u2572               \\n\\\n- \u2572      \u221e       \\n\\\n-  \u2572     \u2320       \\n\\\n-   \u2572    \u23ae   n   \\n\\\n-    \u2572   \u23ae  x  dx\\n\\\n-    \u2571   \u2321       \\n\\\n-   \u2571    -\u221e      \\n\\\n-  \u2571    k        \\n\\\n- \u2571              \\n\\\n+ \u2572              \\n\\\n+  \u2572     \u221e       \\n\\\n+   \u2572    \u2320       \\n\\\n+    \u2572   \u23ae   n   \\n\\\n+    \u2571   \u23ae  x  dx\\n\\\n+   \u2571    \u2321       \\n\\\n+  \u2571     -\u221e      \\n\\\n+ \u2571     k        \\n\\\n \u2571               \\n\\\n \u203e\u203e\u203e\u203e\u203e\u203e          \\n\\\n k = 0           \\\n@@ -4474,14 +4474,14 @@ def test_pretty_sum():\n -\u221e                \\n\\\n  ______           \\n\\\n  \u2572                \\n\\\n-  \u2572       \u221e       \\n\\\n-   \u2572      \u2320       \\n\\\n-    \u2572     \u23ae   n   \\n\\\n-     \u2572    \u23ae  x  dx\\n\\\n-     \u2571    \u2321       \\n\\\n-    \u2571     -\u221e      \\n\\\n-   \u2571     k        \\n\\\n-  \u2571               \\n\\\n+  \u2572               \\n\\\n+   \u2572      \u221e       \\n\\\n+    \u2572     \u2320       \\n\\\n+     \u2572    \u23ae   n   \\n\\\n+     \u2571    \u23ae  x  dx\\n\\\n+    \u2571     \u2321       \\n\\\n+   \u2571      -\u221e      \\n\\\n+  \u2571      k        \\n\\\n  \u2571                \\n\\\n  \u203e\u203e\u203e\u203e\u203e\u203e           \\n\\\n  k = 0            \\\n@@ -4527,14 +4527,14 @@ def test_pretty_sum():\n           -\u221e                         \\n\\\n            ______                    \\n\\\n            \u2572                         \\n\\\n-            \u2572                \u221e       \\n\\\n-             \u2572               \u2320       \\n\\\n-              \u2572              \u23ae   n   \\n\\\n-               \u2572             \u23ae  x  dx\\n\\\n-               \u2571             \u2321       \\n\\\n-              \u2571              -\u221e      \\n\\\n-             \u2571              k        \\n\\\n-            \u2571                        \\n\\\n+            \u2572                        \\n\\\n+             \u2572               \u221e       \\n\\\n+              \u2572              \u2320       \\n\\\n+               \u2572             \u23ae   n   \\n\\\n+               \u2571             \u23ae  x  dx\\n\\\n+              \u2571              \u2321       \\n\\\n+             \u2571               -\u221e      \\n\\\n+            \u2571               k        \\n\\\n            \u2571                         \\n\\\n            \u203e\u203e\u203e\u203e\u203e\u203e                    \\n\\\n      2        2       1   x          \\n\\\n@@ -4572,14 +4572,14 @@ def test_pretty_sum():\n                   x   n          \\n\\\n          ______                  \\n\\\n          \u2572                       \\n\\\n-          \u2572              \u221e       \\n\\\n-           \u2572             \u2320       \\n\\\n-            \u2572            \u23ae   n   \\n\\\n-             \u2572           \u23ae  x  dx\\n\\\n-             \u2571           \u2321       \\n\\\n-            \u2571            -\u221e      \\n\\\n-           \u2571            k        \\n\\\n-          \u2571                      \\n\\\n+          \u2572                      \\n\\\n+           \u2572             \u221e       \\n\\\n+            \u2572            \u2320       \\n\\\n+             \u2572           \u23ae   n   \\n\\\n+             \u2571           \u23ae  x  dx\\n\\\n+            \u2571            \u2321       \\n\\\n+           \u2571             -\u221e      \\n\\\n+          \u2571             k        \\n\\\n          \u2571                       \\n\\\n          \u203e\u203e\u203e\u203e\u203e\u203e                  \\n\\\n          k = 0                   \\\n@@ -4602,8 +4602,8 @@ def test_pretty_sum():\n   \u221e    \\n\\\n  ___   \\n\\\n  \u2572     \\n\\\n-  \u2572   x\\n\\\n-  \u2571    \\n\\\n+  \u2572    \\n\\\n+  \u2571   x\\n\\\n  \u2571     \\n\\\n  \u203e\u203e\u203e   \\n\\\n x = 0  \\\n@@ -4655,10 +4655,10 @@ def test_pretty_sum():\n   \u221e    \\n\\\n  ____  \\n\\\n  \u2572     \\n\\\n-  \u2572   x\\n\\\n-   \u2572  \u2500\\n\\\n-   \u2571  2\\n\\\n-  \u2571    \\n\\\n+  \u2572    \\n\\\n+   \u2572  x\\n\\\n+   \u2571  \u2500\\n\\\n+  \u2571   2\\n\\\n  \u2571     \\n\\\n  \u203e\u203e\u203e\u203e  \\n\\\n x = 0  \\\n@@ -4716,12 +4716,12 @@ def test_pretty_sum():\n   \u221e           \\n\\\n _____         \\n\\\n \u2572             \\n\\\n- \u2572           n\\n\\\n-  \u2572   \u239b    x\u239e \\n\\\n-   \u2572  \u239c    \u2500\u239f \\n\\\n-   \u2571  \u239c 3  2\u239f \\n\\\n-  \u2571   \u239dx \u22c5y \u23a0 \\n\\\n- \u2571            \\n\\\n+ \u2572            \\n\\\n+  \u2572          n\\n\\\n+   \u2572  \u239b    x\u239e \\n\\\n+   \u2571  \u239c    \u2500\u239f \\n\\\n+  \u2571   \u239c 3  2\u239f \\n\\\n+ \u2571    \u239dx \u22c5y \u23a0 \\n\\\n \u2571             \\n\\\n \u203e\u203e\u203e\u203e\u203e         \\n\\\n x = 0         \\\n@@ -4844,14 +4844,14 @@ def test_pretty_sum():\n     \u221e          n                         \\n\\\n   ______   ______                        \\n\\\n   \u2572        \u2572                             \\n\\\n-   \u2572        \u2572     \u239b        1    \u239e        \\n\\\n-    \u2572        \u2572    \u239c1 + \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u239f        \\n\\\n-     \u2572        \u2572   \u239c          1  \u239f        \\n\\\n-      \u2572        \u2572  \u239c    1 + \u2500\u2500\u2500\u2500\u2500\u239f     1  \\n\\\n-      \u2571        \u2571  \u239c            1\u239f + \u2500\u2500\u2500\u2500\u2500\\n\\\n-     \u2571        \u2571   \u239c        1 + \u2500\u239f       1\\n\\\n-    \u2571        \u2571    \u239d            k\u23a0   1 + \u2500\\n\\\n-   \u2571        \u2571                           k\\n\\\n+   \u2572        \u2572                            \\n\\\n+    \u2572        \u2572    \u239b        1    \u239e        \\n\\\n+     \u2572        \u2572   \u239c1 + \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u239f        \\n\\\n+      \u2572        \u2572  \u239c          1  \u239f     1  \\n\\\n+      \u2571        \u2571  \u239c    1 + \u2500\u2500\u2500\u2500\u2500\u239f + \u2500\u2500\u2500\u2500\u2500\\n\\\n+     \u2571        \u2571   \u239c            1\u239f       1\\n\\\n+    \u2571        \u2571    \u239c        1 + \u2500\u239f   1 + \u2500\\n\\\n+   \u2571        \u2571     \u239d            k\u23a0       k\\n\\\n   \u2571        \u2571                             \\n\\\n   \u203e\u203e\u203e\u203e\u203e\u203e   \u203e\u203e\u203e\u203e\u203e\u203e                        \\n\\\n       1   k = 111                        \\n\\\n",
        "repo": "sympy/sympy",
        "problem_statement": "Bad centering for Sum pretty print\n```\r\n>>> pprint(Sum(x, (x, 1, oo)) + 3)\r\n  \u221e\r\n ___\r\n \u2572\r\n  \u2572   x\r\n  \u2571     + 3\r\n \u2571\r\n \u203e\u203e\u203e\r\nx = 1\r\n```\r\n\r\nThe `x` and the `+ 3` should be aligned. I'm not sure if the `x` should be lower of if the `+ 3` should be higher. \n",
        "version": "1.5",
        "FAIL_TO_PASS": [
            "test_pretty_sum"
        ],
        "PASS_TO_PASS": [
            "test_Adjoint",
            "test_Assignment",
            "test_AugmentedAssignment",
            "test_EulerGamma",
            "test_GoldenRatio",
            "test_GroebnerBasis",
            "test_Homomorphism",
            "test_MatrixElement_printing",
            "test_MatrixExpressions",
            "test_MatrixSymbol_printing",
            "test_PrettyModules",
            "test_PrettyPoly",
            "test_ProductSet_paranthesis",
            "test_ProductSet_prod_char_issue_10413",
            "test_QuotientRing",
            "test_RandomDomain",
            "test_SingularityFunction",
            "test_Tr",
            "test_any_object_in_sequence",
            "test_beta",
            "test_categories",
            "test_center_accent",
            "test_complicated_symbol_unchanged",
            "test_degree_printing",
            "test_deltas",
            "test_diffgeom_print_WedgeProduct",
            "test_elliptic_functions",
            "test_expint",
            "test_function_subclass_different_name",
            "test_gammas",
            "test_hyper",
            "test_issue_10472",
            "test_issue_11801",
            "test_issue_12675",
            "test_issue_13651",
            "test_issue_15560",
            "test_issue_15583",
            "test_issue_4335",
            "test_issue_5524",
            "test_issue_6134",
            "test_issue_6285",
            "test_issue_6324",
            "test_issue_6359",
            "test_issue_6739",
            "test_issue_7117",
            "test_issue_7179",
            "test_issue_7180",
            "test_issue_7927",
            "test_issue_9877",
            "test_matrixSymbolBold",
            "test_meijerg",
            "test_missing_in_2X_issue_9047",
            "test_negative_fractions",
            "test_noncommutative",
            "test_pprint",
            "test_pretty_Add",
            "test_pretty_Boolean",
            "test_pretty_Complement",
            "test_pretty_ComplexRegion",
            "test_pretty_ComplexRootOf",
            "test_pretty_ConditionSet",
            "test_pretty_Contains",
            "test_pretty_Cycle",
            "test_pretty_Domain",
            "test_pretty_FormalPowerSeries",
            "test_pretty_FourierSeries",
            "test_pretty_ITE",
            "test_pretty_ImageSet",
            "test_pretty_Intersection_issue_10414",
            "test_pretty_KroneckerDelta",
            "test_pretty_Mod",
            "test_pretty_RootSum",
            "test_pretty_SetExpr",
            "test_pretty_Subs",
            "test_pretty_SymmetricDifference",
            "test_pretty_Trace_issue_9044",
            "test_pretty_UnevaluatedExpr",
            "test_pretty_Union_issue_10414",
            "test_pretty_ascii_str",
            "test_pretty_basic",
            "test_pretty_class",
            "test_pretty_derivatives",
            "test_pretty_dotproduct",
            "test_pretty_functions",
            "test_pretty_geometry",
            "test_pretty_integrals",
            "test_pretty_lambda",
            "test_pretty_limits",
            "test_pretty_matrix",
            "test_pretty_ndim_arrays",
            "test_pretty_no_wrap_line",
            "test_pretty_order",
            "test_pretty_ordering",
            "test_pretty_piecewise",
            "test_pretty_prec",
            "test_pretty_primenu",
            "test_pretty_primeomega",
            "test_pretty_print_tensor_expr",
            "test_pretty_print_tensor_partial_deriv",
            "test_pretty_product",
            "test_pretty_rational",
            "test_pretty_relational",
            "test_pretty_seq",
            "test_pretty_sequences",
            "test_pretty_sets",
            "test_pretty_special_functions",
            "test_pretty_sqrt",
            "test_pretty_sqrt_char_knob",
            "test_pretty_sqrt_longsymbol_no_sqrt_char",
            "test_pretty_unicode_str",
            "test_print_builtin_set",
            "test_print_lerchphi",
            "test_settings",
            "test_tensor_TensorProduct",
            "test_units",
            "test_upretty_greek",
            "test_upretty_modifiers",
            "test_upretty_multiindex",
            "test_upretty_sub_super",
            "test_upretty_subs_missing_in_24",
            "test_vector_expr_pretty_printing"
        ],
        "environment_setup_commit": "70381f282f2d9d039da860e391fe51649df2779d",
        "patch": "diff --git a/sympy/printing/pretty/pretty.py b/sympy/printing/pretty/pretty.py\n--- a/sympy/printing/pretty/pretty.py\n+++ b/sympy/printing/pretty/pretty.py\n@@ -564,7 +564,7 @@ def adjust(s, wid=None, how='<^>'):\n                 for i in reversed(range(1, d)):\n                     lines.append('%s/%s' % (' '*i, ' '*(w - i)))\n                 lines.append(\"/\" + \"_\"*(w - 1) + ',')\n-                return d, h + more, lines, 0\n+                return d, h + more, lines, more\n             else:\n                 w = w + more\n                 d = d + more\n@@ -619,7 +619,7 @@ def adjust(s, wid=None, how='<^>'):\n             if first:\n                 # change F baseline so it centers on the sign\n                 prettyF.baseline -= d - (prettyF.height()//2 -\n-                                         prettyF.baseline) - adjustment\n+                                         prettyF.baseline)\n                 first = False\n \n             # put padding to the right\n@@ -629,7 +629,11 @@ def adjust(s, wid=None, how='<^>'):\n             # put the present prettyF to the right\n             prettyF = prettyForm(*prettySign.right(prettyF))\n \n-        prettyF.baseline = max_upper + sign_height//2\n+        # adjust baseline of ascii mode sigma with an odd height so that it is\n+        # exactly through the center\n+        ascii_adjustment = ascii_mode if not adjustment else 0\n+        prettyF.baseline = max_upper + sign_height//2 + ascii_adjustment\n+\n         prettyF.binding = prettyForm.MUL\n         return prettyF\n \n",
        "pr_link": "https://github.com/sympy/sympy/pull/16503"
    }
}